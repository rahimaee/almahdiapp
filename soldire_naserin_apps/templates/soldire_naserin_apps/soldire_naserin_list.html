{% extends 'shared/_PanelMain.html' %}
{% load static %}
{% load jalali_filters %}
{% block header %}
    <style>
        body {
            direction: rtl;
            background: #f5f5f5;
            font-family: 'Tahoma';
        }

        .container {
            margin-top: 40px;
        }

        h2 {
            margin-bottom: 30px;
            color: #2c3e50;
            font-weight: bold;
        }

        .custom-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }

        .custom-table th {
            background: #27ae60;
            color: white;
            text-align: center;
            font-size: 13px;
        }

        .custom-table td {
            text-align: center;
            vertical-align: middle !important;
            font-size: 13px;
        }

        .btn-export {
            margin-bottom: 20px;
        }
    </style>
{% endblock %}

{% block main %}

    <div class="container">
        <h2 class="text-center">Ø¬Ø¯ÙˆÙ„ Ø§ÙØ±Ø§Ø¯ Ùˆ Ú¯Ø±ÙˆÙ‡ Ù‡Ø§ÛŒ Ù†Ø§ØµØ±ÛŒÙ†</h2>

        <button class="btn btn-success btn-export" onclick="exportToExcel()">ğŸ“¥ Ø®Ø±ÙˆØ¬ÛŒ Ø§Ú©Ø³Ù„ Ù„ÛŒØ³Øª</button>

        <div class="table-responsive">
            <table class="table table-bordered custom-table" id="dataTable">
                <thead>
                <tr>
                    <th>Ú©Ø¯ Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ</th>
                    <th>Ú©Ø¯ Ù…Ù„ÛŒ</th>
                    <th>Ù†Ø§Ù…</th>
                    <th>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th>
                    <th>Ù…Ù‚Ø·Ø¹ ØªØ­ØµÛŒÙ„ÛŒ</th>
                    <th>Ø³Ø·Ø­</th>
                    <th>Ø´Ù…Ø§Ø±Ù‡ Ù‡Ù…Ø±Ø§Ù‡</th>
                    <th>Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡</th>
                    <th>Ù†Ø§Ù… Ø³Ø±Ú¯Ø±ÙˆÙ‡</th>
                    <th>ÙˆØ¶Ø¹ÛŒØª ÙØ±Ø§Ø±</th>
                    <th>Ù†Ø§Ù… Ù‚Ø³Ù…Øª</th>
                    <th>Ø²ÛŒØ±Ù‚Ø³Ù…Øª</th>
                    <th>ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù†</th>
                    <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                </tr>
                </thead>
                <tbody>
                {% for soldire in soldires %}
                    <tr>
                        <td>{{ soldire.organizational_code.code_number }}</td>
                        <td>{{ soldire.national_code }}</td>
                        <td>{{ soldire.first_name }}</td>
                        <td>{{ soldire.last_name }}</td>
                        <td>{{ soldire.degree }}</td>
                        <td>1</td>
                        <td>{{ soldire.phone_mobile }}</td>
                        <td>
                            {% if soldire.naserin_group %}
                                {{ soldire.naserin_group.name }}
                            {% else %}
                                Ù†Ø¯Ø§Ø±Ø¯
                            {% endif %}
                        </td>
                        <td>
                            {% if soldire.naserin_group %}
                                {{ soldire.naserin_group.manager.get_full_name }}
                            {% else %}
                                Ù†Ø¯Ø§Ø±Ø¯
                            {% endif %}
                        </td>
                        <td>
                            {% if soldire.is_fugitive %}
                                Ø¨Ù„Ù‡
                            {% else %}
                                Ø®ÛŒØ±
                            {% endif %}
                        </td>
                        <td>{{ soldire.current_parent_unit.name }}</td>
                        <td>{{ soldire.current_sub_unit.name }}</td>
                        <td>{{ soldire.service_end_date|to_jalali }}</td>
                        <td>
                            <a href="{% url 'edit_soldier_naserin' soldier_id=soldire.id %}">ØªØ®ØµÛŒØµ Ú¯Ø±ÙˆÙ‡</a>
                            <a href="{% url 'soldier_detail' pk=soldire.id %}">Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙØ±Ø¯</a>
                        </td>

                    </tr>
                {% endfor %}
                <!-- Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ± -->
                </tbody>
            </table>
        </div>
    </div>

{% endblock %}


{% block footer %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        function exportToExcel() {
            var table = document.getElementById("dataTable");
            var ws = XLSX.utils.aoa_to_sheet([]);

            for (let i = 0; i < table.rows.length; i++) {
                let row = [];
                for (let j = 0; j < table.rows[i].cells.length; j++) {
                    let cellText = table.rows[i].cells[j].innerText.trim();
                    row.push({v: cellText, t: "s"}); // force text (string) type
                }
                XLSX.utils.sheet_add_aoa(ws, [row], {origin: -1});
            }

            var wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
            XLSX.writeFile(wb, "Ø¬Ø¯ÙˆÙ„_Ø§ÙØ±Ø§Ø¯.xlsx");
        }
    </script>
{% endblock %}